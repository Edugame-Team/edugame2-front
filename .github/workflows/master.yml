name: Deploy on Production
on:
  push:
    branches:
      - master
jobs:
  deploy:
    name: Deploy on production
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v1

      - name: Get current version
        run:  echo "EDUGAME_PROJECT_VERSION=$(node -p "require('./package.json').version")" >> $GITHUB_ENV

      #- name: Cache Docker layers
      #  uses: actions/cache@v2
      #  with:
      #    path: /tmp/.buildx-cache
      #    key: ${{ runner.os }}-buildx-${{ github.sha }}
      #    restore-keys: |
      #    ${{ runner.os }}-buildx-

      - name: Tag Release
        uses: shrink/actions-docker-registry-tag@v1
        with:
          registry: hub.docker.com
          token: ${{ secrets.DOCKER_HUB_ACCESS_TOKEN }}
          repository: edugame/front
          target: ${{ env.EDUGAME_PROJECT_VERSION }}
          tags: |
            production
